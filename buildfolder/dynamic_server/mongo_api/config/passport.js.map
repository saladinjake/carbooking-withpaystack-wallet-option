{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/config/passport.js"],"names":["passport","require","FacebookStrategy","Strategy","TwitterStrategy","GoogleStrategy","InstagramStrategy","User","config","module","exports","use","clientID","facebook","clientSecret","callbackURL","profileFields","accessToken","refreshToken","profile","done","_json","email","first_name","last_name","findOne","err","user","console","log","id","AutoincrementId","counter","name","displayName","firstname","lastname","created","Date","now","save","JSON","stringify","consumerKey","twitter","consumerSecret","oauthID","username","google","request","instagram"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","sourcesContent":["var passport = require('passport');\nvar FacebookStrategy = require('passport-facebook').Strategy;\nvar TwitterStrategy = require('passport-twitter').Strategy;\nvar GoogleStrategy = require('passport-google-oauth2').Strategy;\nvar InstagramStrategy = require('passport-instagram').Strategy;\nvar User = require('../models/User.model');\nvar config = require('./mongo_config');\nimport AutoincrementId from '../helpers/autoincrement_mongo.js';\nmodule.exports = passport.use(new FacebookStrategy({\n  clientID: config.facebook.clientID,\n  clientSecret: config.facebook.clientSecret,\n  callbackURL: config.facebook.callbackURL,\n   profileFields: [\"email\", \"name\"]\n  },\n  function(accessToken, refreshToken, profile, done) {\n    //console.log(JSON.stringify(profile._json))\n    const { email, first_name, last_name } = profile._json;\n      // const userData = {\n      //   email,\n      //   firstName: first_name,\n      //   lastName: last_name\n      // };\n      // new userModel(userData).save();\n      // done(null, profile);\n\n\n  //   User.findOne({ email: email }, function(err, user) {\n  //     if(err) {\n  //       console.log(err);  // handle errors!\n  //     }\n  //     if (!err && user !== null) {\n  //        console.log('user already signed up')\n  //       done(null, user);\n  //     } else {\n  //       user = new User({\n  //         oauthID: profile.id,\n  //         username: profile.displayName,\n  //         firstname: first_name,\n  //         lastname: last_name,\n  //         created: Date.now()\n  //       });\n  //       user.save(function(err) {\n  //         if(err) {\n  //           console.log(err);  // handle errors!\n  //         } else {\n  //           console.log(\"saving user ...\");\n  //           done(null, user);\n  //         }\n  //       });\n  //     }\n  //   });\n  // }\n\n  User.findOne({ email: email }, function(err, user) {\n      if(err) {\n        console.log(err);  // handle errors!\n      }\n      if (!err && user !== null) {\n        done(null, user);\n      } else {\n        user = new User({\n          id: new AutoincrementId(User).counter(),\n          name: profile.displayName,\n          email: email,\n          firstname: first_name,\n          lastname: last_name,\n\n          created: Date.now()\n        });\n        user.save(function(err,user) {\n          if(err) {\n            console.log(err);  // handle errors!\n          } else {\n            console.log(\"saving user ...\");\n            console.log(JSON.stringify(user))\n            done(null, user);\n          }\n        });\n      }\n    });\n  }\n));\n\npassport.use(new TwitterStrategy({\n  consumerKey: config.twitter.consumerKey,\n  consumerSecret: config.twitter.consumerSecret,\n  callbackURL: config.twitter.callbackURL\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({ oauthID: profile.id }, function(err, user) {\n      if(err) {\n        console.log(err);  // handle errors!\n      }\n      if (!err && user !== null) {\n        done(null, user);\n      } else {\n        user = new User({\n          oauthID: profile.id,\n          username: profile.displayName,\n          created: Date.now()\n        });\n        user.save(function(err) {\n          if(err) {\n            console.log(err);  // handle errors!\n          } else {\n            console.log(\"saving user ...\");\n            done(null, user);\n          }\n        });\n      }\n    });\n  }\n));\n\n\npassport.use(new GoogleStrategy({\n  clientID: config.google.clientID,\n  clientSecret: config.google.clientSecret,\n  callbackURL: config.google.callbackURL\n  },\n  function(request, accessToken, refreshToken, profile, done) {\n    User.findOne({ oauthID: profile.id }, function(err, user) {\n      if(err) {\n        console.log(err);  // handle errors!\n      }\n      if (!err && user !== null) {\n        done(null, user);\n      } else {\n        user = new User({\n          oauthID: profile.id,\n          name: profile.displayName,\n          created: Date.now()\n        });\n        user.save(function(err) {\n          if(err) {\n            console.log(err);  // handle errors!\n          } else {\n            console.log(\"saving user ...\");\n            done(null, user);\n          }\n        });\n      }\n    });\n  }\n));\n\npassport.use(new InstagramStrategy({\n  clientID: config.instagram.clientID,\n  clientSecret: config.instagram.clientSecret,\n  callbackURL: config.instagram.callbackURL\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({ oauthID: profile.id }, function(err, user) {\n      if(err) {\n        console.log(err);  // handle errors!\n      }\n      if (!err && user !== null) {\n        done(null, user);\n      } else {\n        user = new User({\n          oauthID: profile.id,\n          name: profile.displayName,\n          created: Date.now()\n        });\n        user.save(function(err) {\n          if(err) {\n            console.log(err);  // handle errors!\n          } else {\n            console.log(\"saving user ...\");\n            done(null, user);\n          }\n        });\n      }\n    });\n  }\n));"],"file":"passport.js"}