{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/config/passport.js"],"names":["passport","require","FacebookStrategy","Strategy","TwitterStrategy","GoogleStrategy","InstagramStrategy","User","config","module","exports","use","clientID","facebook","clientSecret","callbackURL","profileFields","accessToken","refreshToken","profile","done","_json","email","first_name","last_name","findOne","err","user","console","log","id","AutoincrementId","counter","name","displayName","firstname","lastname","created","Date","now","save","JSON","stringify","consumerKey","twitter","consumerSecret","oauthID","username","google","request","instagram"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","sourcesContent":["var passport = require('passport');\nvar FacebookStrategy = require('passport-facebook').Strategy;\nvar TwitterStrategy = require('passport-twitter').Strategy;\nvar GoogleStrategy = require('passport-google-oauth2').Strategy;\nvar InstagramStrategy = require('passport-instagram').Strategy;\nvar User = require('../models/User.model');\nvar config = require('./mongo_config');\nimport AutoincrementId from '../helpers/autoincrement_mongo.js';\n/****************************************************************/\n/******* @author saladin jake (Victor juwa) ********************************/\n/******* @desc Express js || ****************/\nmodule.exports = passport.use(\n  new FacebookStrategy(\n    {\n      clientID: config.facebook.clientID,\n      clientSecret: config.facebook.clientSecret,\n      callbackURL: config.facebook.callbackURL,\n      profileFields: ['email', 'name'],\n    },\n    function(accessToken, refreshToken, profile, done) {\n      //console.log(JSON.stringify(profile._json))\n      const { email, first_name, last_name } = profile._json;\n      // const userData = {\n      //   email,\n      //   firstName: first_name,\n      //   lastName: last_name\n      // };\n      // new userModel(userData).save();\n      // done(null, profile);\n\n      //   User.findOne({ email: email }, function(err, user) {\n      //     if(err) {\n      //       console.log(err);  // handle errors!\n      //     }\n      //     if (!err && user !== null) {\n      //        console.log('user already signed up')\n      //       done(null, user);\n      //     } else {\n      //       user = new User({\n      //         oauthID: profile.id,\n      //         username: profile.displayName,\n      //         firstname: first_name,\n      //         lastname: last_name,\n      //         created: Date.now()\n      //       });\n      //       user.save(function(err) {\n      //         if(err) {\n      //           console.log(err);  // handle errors!\n      //         } else {\n      //           console.log(\"saving user ...\");\n      //           done(null, user);\n      //         }\n      //       });\n      //     }\n      //   });\n      // }\n\n      User.findOne({ email: email }, function(err, user) {\n        if (err) {\n          console.log(err); // handle errors!\n        }\n        if (!err && user !== null) {\n          done(null, user);\n        } else {\n          user = new User({\n            id: new AutoincrementId(User).counter(),\n            name: profile.displayName,\n            email: email,\n            firstname: first_name,\n            lastname: last_name,\n\n            created: Date.now(),\n          });\n          user.save(function(err, user) {\n            if (err) {\n              console.log(err); // handle errors!\n            } else {\n              console.log('saving user ...');\n              console.log(JSON.stringify(user));\n              done(null, user);\n            }\n          });\n        }\n      });\n    },\n  ),\n);\n\npassport.use(\n  new TwitterStrategy(\n    {\n      consumerKey: config.twitter.consumerKey,\n      consumerSecret: config.twitter.consumerSecret,\n      callbackURL: config.twitter.callbackURL,\n    },\n    function(accessToken, refreshToken, profile, done) {\n      User.findOne({ oauthID: profile.id }, function(err, user) {\n        if (err) {\n          console.log(err); // handle errors!\n        }\n        if (!err && user !== null) {\n          done(null, user);\n        } else {\n          user = new User({\n            oauthID: profile.id,\n            username: profile.displayName,\n            created: Date.now(),\n          });\n          user.save(function(err) {\n            if (err) {\n              console.log(err); // handle errors!\n            } else {\n              console.log('saving user ...');\n              done(null, user);\n            }\n          });\n        }\n      });\n    },\n  ),\n);\n\npassport.use(\n  new GoogleStrategy(\n    {\n      clientID: config.google.clientID,\n      clientSecret: config.google.clientSecret,\n      callbackURL: config.google.callbackURL,\n    },\n    function(request, accessToken, refreshToken, profile, done) {\n      User.findOne({ oauthID: profile.id }, function(err, user) {\n        if (err) {\n          console.log(err); // handle errors!\n        }\n        if (!err && user !== null) {\n          done(null, user);\n        } else {\n          user = new User({\n            oauthID: profile.id,\n            name: profile.displayName,\n            created: Date.now(),\n          });\n          user.save(function(err) {\n            if (err) {\n              console.log(err); // handle errors!\n            } else {\n              console.log('saving user ...');\n              done(null, user);\n            }\n          });\n        }\n      });\n    },\n  ),\n);\n\npassport.use(\n  new InstagramStrategy(\n    {\n      clientID: config.instagram.clientID,\n      clientSecret: config.instagram.clientSecret,\n      callbackURL: config.instagram.callbackURL,\n    },\n    function(accessToken, refreshToken, profile, done) {\n      User.findOne({ oauthID: profile.id }, function(err, user) {\n        if (err) {\n          console.log(err); // handle errors!\n        }\n        if (!err && user !== null) {\n          done(null, user);\n        } else {\n          user = new User({\n            oauthID: profile.id,\n            name: profile.displayName,\n            created: Date.now(),\n          });\n          user.save(function(err) {\n            if (err) {\n              console.log(err); // handle errors!\n            } else {\n              console.log('saving user ...');\n              done(null, user);\n            }\n          });\n        }\n      });\n    },\n  ),\n);\n"],"file":"passport.js"}