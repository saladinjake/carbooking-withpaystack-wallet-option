{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/api/auth_routes.js"],"names":["dotenv","config","SIGNUP_LINK","LOGIN_LINK","AuthRoutes","router","get","request","response","status","json","message","post","UserSanitizer","validateSignUp","checkIfUserExists","UserController","signup","validateLogin","checkIfUserIsBanned","login","confirmationPost","resendTokenPost","passwordForgot","confirmResetPassword","changePasswordTrigger","req","res","logout","redirect","createToken","console","log","user","resultingTokenShibilish","id","email","username","accessToken","JWT","sign","process","env","SECRET","expiresIn","token","setHeader","data","passport","authenticate","session","scope"],"mappings":"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","sourcesContent":["import dotenv from 'dotenv';\ndotenv.config();\nimport UserController from '../controllers/user_controller';\nimport UserSanitizer from '../middlewares/user_sanitizer';\n\n// for social media auth\nimport JWT from 'jsonwebtoken';\nimport { TokenGenerator } from '../helpers/token_generator';\n\nimport { passport } from  '../App';\nimport  config from  '../config/mongo_config';\nimport request from 'request';\n\n\n\n// import BridgeRoutes from './routes';\nconst SIGNUP_LINK = '/auth/signup';\nconst LOGIN_LINK = '/auth/login';\nclass AuthRoutes {\n  constructor(router) {\n    // super(router);\n    this.router = router;\n  }\n\n  attachRoutes() {\n    // simplelogins\n    this.router.get('/', (request, response) =>\n      response.status(200).json({\n        message: 'Welcome to commute API',\n      }),\n    );\n    this.router.post(\n      '/auth/signup',\n      UserSanitizer.validateSignUp,\n      UserSanitizer.checkIfUserExists,\n      UserController.signup,\n    );\n    this.router.post('/auth/login', \n      UserSanitizer.validateLogin,\n      UserSanitizer.checkIfUserIsBanned,\n      UserController.login\n     );\n    this.router.get('/auth/confirmation/:id', UserController.confirmationPost);\n    this.router.get('/auth/resend/:id', UserController.resendTokenPost);\n    this.router.post('/auth/forgot_password', UserController.passwordForgot);\n    this.router.get('/auth/resetMyPassword/:id', UserController.confirmResetPassword);//show form\n    this.router.post('/auth/resetpassword', UserController.changePasswordTrigger);\n\n    this.router.get('/logout', function(req, res){\n      req.logout();\n      res.redirect('/');\n    });\n  //   return this.router;\n\n  \nconst createToken = (req, res) => {\n   console.log(req.user)\n   let resultingTokenShibilish ={\n     id: req.user.id,\n     email: req.user.email,\n     username: req.user.username\n   };\n    const accessToken = JWT.sign(resultingTokenShibilish, process.env.SECRET, { expiresIn: 60 * 120 });\n   \n    req.token =  accessToken;\n    res.setHeader('x-auth-token', req.token);\n    res.status(200).json({\n                          status: 200,\n                           data: [\n                                  {\n                                      token:req.token,\n                                      user: req.user,\n                                  },\n                          ],\n                           message: 'User created successfully',\n                        });\n\n\n    //res.redirect(`/${req.roken}`);\n}\n\n\n      this.router.get('/google/start',\n         passport.authenticate('google', { session: false, scope: ['openid', 'profile', 'email'] }));\n      this.router.get('/google/redirect',\n         passport.authenticate('google', { session: false }),\n         createToken);\n\n      this.router.get('/auth/facebook',\n        passport.authenticate('facebook', { session: false, scope: ['public_profile'] }));\n      this.router.get('/auth/facebook/callback/',\n         passport.authenticate('facebook', { session: false }),\n         createToken);\n\n\n       //working code...\n\n\n    // send to google to do the authentication\n    // this.router.get('/auth/facebook',\n    //     passport.authenticate('facebook'),\n    //     function(req, res){});\n    // this.router.get('/auth/facebook/callback',\n    //     passport.authenticate('facebook', {session: false, failureRedirect: '/' }),\n    //     function(req, res) {\n    //        //console.log(req.user)\n    //     if(!req.user) {\n    //         return res.send(401, 'User not authenticated');\n    //     }\n\n    //     if(req.user){\n    //       console.log(req.user)\n    //     }\n\n        \n    //     req.token = createToken(req.user);\n    //     res.setHeader('x-auth-token', req.token);\n    //     res.status(200).json(req.token);\n    //     // res.redirect(`/${req.roken}`);\n        \n    // });\n\n    // this.router.get('/auth/twitter',\n    //     passport.authenticate('twitter'),\n    //     function(req, res){});\n    // this.router.get('/auth/twitter/callback',\n    //     passport.authenticate('twitter', { failureRedirect: '/' }),\n    //     function(req, res) {\n    //       res.redirect('http://localhost:4000');\n    //     });\n\n      \n    // this.router.get('/auth/google',\n    //     passport.authenticate('google', { scope: [\n    //       'https://www.googleapis.com/auth/plus.login',\n    //       'https://www.googleapis.com/auth/plus.profile.emails.read'\n    //     ] }\n    //   ));\n    // this.router.get('/auth/google/callback',\n    //     passport.authenticate('google', { failureRedirect: '/' }),\n        \n    //     function(req, res) {\n    //       res.redirect('http://localhost:4000');\n    // });\n\n    // this.router.get('/auth/instagram',\n    //     passport.authenticate('instagram'),\n    //     function(req, res){});\n    // this.router.get('/auth/instagram/callback',\n    //     passport.authenticate('instagram', { failureRedirect: '/' }),\n    //     function(req, res) {\n    //       res.redirect('/account');\n    // });\n\n\n\n  }\n}\nexport default AuthRoutes;\n"],"file":"auth_routes.js"}