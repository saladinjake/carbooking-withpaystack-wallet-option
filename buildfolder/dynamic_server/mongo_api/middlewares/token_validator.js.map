{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/middlewares/token_validator.js"],"names":["TokenVerification","request","response","next","token","header","console","log","status","json","error","decoded","jwt","verify","process","env","SECRET","user","err","isAdmin"],"mappings":"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","sourcesContent":["import jwt from 'jsonwebtoken';\nimport { ResponseHandler } from '../helpers/response_handler';\n\nexport default class TokenVerification {\n  static userAuthentication(request, response, next) {\n    const token = request.header('x-access-token');\n    //console.log(token)\n    if (!token) {\n      console.log('error validating token');\n      return response.status(401).json({\n        status: 401,\n        error: 'You must signup or login to access this route',\n      });\n    }\n    try {\n      const decoded = jwt.verify(token, process.env.SECRET);\n      request.user = decoded;\n      return next();\n    } catch (err) {\n      return response.status(403).json({\n        status: 403,\n        error: 'Authentication failed',\n      });\n    }\n  }\n\n  static adminAuthentication(request, response, next) {\n\n    const token = request.header('x-access-token');\n  \n    if (!token) {\n      console.log('error validating token');\n      return response.status(401).json({\n        status: 401,\n        error: 'You must signup or login to access this route',\n      });\n    }\n    try {\n      const decoded = jwt.verify(token, process.env.SECRET);\n      request.user = decoded;\n\n      if (request.user.isAdmin === false) {\n\n        return response.status(403).json({\n          status: 403,\n          error: 'You do not have the admin rights to perform this action'\n        });\n      }\n      return next();\n    } catch (err) {\n      return response.status(403).json({\n        status: 403,\n        error: 'Authentication failed',\n      });\n    }\n\n\n    \n  }\n}\n"],"file":"token_validator.js"}