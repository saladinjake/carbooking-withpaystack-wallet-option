{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/models/db.js"],"names":["require","config","debug","Promise","bluebird","mongoose","instance","DbQuery","that","dbLink","pool","connect","keepAlive","useNewUrlParser","useUnifiedTopology","useFindAndModify","useCreateIndex","set","collectionName","method","query","doc","util","inspect","connection","process","env","NODE_ENV"],"mappings":"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","sourcesContent":["require('dotenv').config();\nimport mongoose from 'mongoose';\nimport config from '../config/mongo_config';\nimport bluebird from 'bluebird'\nconst debug = require('debug')('ireport:server');\n\n/* SINGLETON */\nimport  util from 'util';\n// make bluebird default Promise\nPromise = bluebird; // eslint-disable-line no-global-assign\n\n\n\nmongoose.Promise = Promise;\n let instance = null;\nclass DbQuery {\n  constructor() {\n    const that = this;\n    this.dbLink; \n    \n \n\n    this.pool = mongoose.connect(that.connect(),{ \n      keepAlive: 1,\n      // useMongoClient: true,\n      useNewUrlParser: true,\n      useUnifiedTopology: true,\n      useFindAndModify:false,\n      useCreateIndex:true\n    });\n\n\n\n    \n  \n    // print mongoose logs in dev env\n    if (config.debugger) {\n      mongoose.set('debug', (collectionName, method, query, doc) => {\n        debug(`${collectionName}.${method}`, util.inspect(query, false, 20), doc);\n      });\n    }\n  }\n\n  getEstablishedConnection(){\n     // return this.pool;\n     return mongoose.connection;\n  }\n\n  static getInstance() {\n   \n    if (!instance) {\n      instance = new DbQuery();\n    }\n    return instance;\n  }\n\n  connect() {\n    const { NODE_ENV } = process.env;\n\n    if (NODE_ENV === 'development') {  //'mongodb://localhost:27017/taxi_service_final'\n      this.dbLink =   'mongodb+srv://platform:@Platform123.@commutetest-f3rhn.mongodb.net/commute_taxi_service' //process.env.MONGODB_MLAB_URL || process.env.MONGO_DATABASE_URL   //process.env.MONGODB_URI || 'mongodb://localhost:27017/taxi_service_final';//config.development.database;\n    } else if (NODE_ENV === 'test') {\n      this.dbLink =  'mongodb+srv://platform:@Platform123.@commutetest-f3rhn.mongodb.net/commute_taxi_service' //process.env.MONGODB_MLAB_URL || process.env.MONGO_DATABASE_URL  //process.env.MONGODB_URI || 'mongodb://localhost:27017/taxi_service_final'; //config.test.database;\n    } else {\n      this.dbLink =  'mongodb+srv://platform:@Platform123.@commutetest-f3rhn.mongodb.net/commute_taxi_service'  //process.env.MONGODB_MLAB_URL || process.env.MONGO_DATABASE_URL //process.env.MONGODB_URI || 'mongodb://localhost:27017/taxi_service_final';  //config.production.database;\n    }\n    \n    return this.dbLink;\n  }\n}\n\n\n\n\n\nexport default DbQuery;\n"],"file":"db.js"}