{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/services/transferService.js"],"names":["uuidv4","require","crypto","moment","GatewayTransaction","APIError","httpStatus","Customer","Transaction","exports","transfer","accountNumber","amount","destinationAccountNumber","reference","transaction","operation","save","savedTransaction","findOne","savedCustomer","transactionBeneficiary","savedTransactionBeneficiary","response","transform","customer","transformBalance"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,MAAM,2BAAGC,OAAO,CAAC,SAAD,CAAV,CAAZ;AACA,IAAMC,MAAM,2BAAGD,OAAO,CAAC,QAAD,CAAV,CAAZ;AACA,IAAME,MAAM,2BAAGF,OAAO,CAAC,iBAAD,CAAV,CAAZ;AACA,IAAMG,kBAAkB,2BAAGH,OAAO,CAAC,oCAAD,CAAV,CAAxB;AACA,IAAMI,QAAQ,2BAAGJ,OAAO,CAAC,mBAAD,CAAV,CAAd;AACA,IAAMK,UAAU,2BAAGL,OAAO,CAAC,aAAD,CAAV,CAAhB;AACA,IAAMM,QAAQ,2BAAGN,OAAO,CAAC,sBAAD,CAAV,CAAd;AACA,IAAMO,WAAW,2BAAGP,OAAO,CAAC,6BAAD,CAAV,CAAjB;;;AAEAQ,OAAO,CAACC,QAAR,GAAmB,iBAAOC,aAAP,EAAsBC,MAAtB,EAA8BC,wBAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACTC,UAAAA,SADS,2BACGd,MAAM,EADT;AAGTe,UAAAA,WAHS,4BAGK,IAAIP,WAAJ,EAHL;AAAA;AAIfO,UAAAA,WAAW,CAACH,MAAZ,GAAqB,CAACA,MAAtB;AAJe;AAKfG,UAAAA,WAAW,CAACC,SAAZ,GAAwB,UAAxB;AALe;AAMfD,UAAAA,WAAW,CAACJ,aAAZ,GAA4BA,aAA5B;AANe;AAOfI,UAAAA,WAAW,CAACF,wBAAZ,GAAuCA,wBAAvC;AAPe;AAQfE,UAAAA,WAAW,CAACD,SAAZ,GAAwB,yBAAyBD,wBAAjD;AARe;AAAA;AAAA,+CASgBE,WAAW,CAACE,IAAZ,EAThB;;AAAA;AASTC,UAAAA,gBATS;AAAA;AAAA;AAAA,+CAUaX,QAAQ,CAACY,OAAT,CAAiB;AAAE,6BAAiBR;AAAnB,WAAjB,CAVb;;AAAA;AAUTS,UAAAA,aAVS;AAYTC,UAAAA,sBAZS,4BAYgB,IAAIb,WAAJ,EAZhB;AAAA;AAafa,UAAAA,sBAAsB,CAACT,MAAvB,GAAgCA,MAAhC;AAbe;AAcfS,UAAAA,sBAAsB,CAACL,SAAvB,GAAmC,UAAnC;AAde;AAefK,UAAAA,sBAAsB,CAACV,aAAvB,GAAuCE,wBAAvC;AAfe;AAgBfQ,UAAAA,sBAAsB,CAACP,SAAvB,GAAmC,2BAA2BH,aAA9D;AAhBe;AAAA;AAAA,+CAiB2BU,sBAAsB,CAACJ,IAAvB,EAjB3B;;AAAA;AAiBTK,UAAAA,2BAjBS;AAmBTC,UAAAA,QAnBS,4BAmBE;AAAER,YAAAA,WAAW,EAAEA,WAAW,CAACS,SAAZ,EAAf;AAAwCC,YAAAA,QAAQ,EAAEL,aAAa,CAACM,gBAAd;AAAlD,WAnBF;AAAA;AAAA,2CAqBRH,QArBQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAnB","sourcesContent":["const uuidv4 = require('uuid/v4');\nconst crypto = require('crypto');\nconst moment = require('moment-timezone');\nconst GatewayTransaction = require('../models/gatewayTransaction.model');\nconst APIError = require('../utils/APIError');\nconst httpStatus = require('http-status');\nconst Customer = require('../models/User.model');\nconst Transaction = require('../models/transaction.model');\n\nexports.transfer = async (accountNumber, amount, destinationAccountNumber) => {\n    const reference = uuidv4();\n\n    const transaction = new Transaction();\n    transaction.amount = -amount;\n    transaction.operation = 'transfer';\n    transaction.accountNumber = accountNumber;\n    transaction.destinationAccountNumber = destinationAccountNumber;\n    transaction.reference = 'transfer_to_account:' + destinationAccountNumber;\n    const savedTransaction = await transaction.save();\n    const savedCustomer = await Customer.findOne({ 'accountNumber': accountNumber });\n\n    const transactionBeneficiary = new Transaction();\n    transactionBeneficiary.amount = amount;\n    transactionBeneficiary.operation = 'transfer';\n    transactionBeneficiary.accountNumber = destinationAccountNumber;\n    transactionBeneficiary.reference = 'transfer_from_account:' + accountNumber;\n    const savedTransactionBeneficiary = await transactionBeneficiary.save();\n\n    const response = { transaction: transaction.transform(), customer: savedCustomer.transformBalance() }\n    \n    return response;\n  };"],"file":"transferService.js"}