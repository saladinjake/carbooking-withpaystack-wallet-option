{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/services/sos_service.js"],"names":["MongooseDatabase","getInstance","Database","RedFlagService","request","response","body","user_id","location","filename","address","status","media","email","phone_number","plate_number","username","console","log","postData","NewRedflag","RedFlagModel","id","AutoincrementId","counter","save","then","data","redFlag","json","message","err","error","ErrorHandler","errors","validationError","find","length","Number","params","redflags","JSON","stringify","removeOne","deletedRedFlag","_id","redflagId","user","updateOne","editRedFlags","comment","editCommentRedFlag","send","redId","redflagStatus","redFlags","type","description","NewNotification","NotificationModel","notification","notifications"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","sourcesContent":["//import mongoose from 'mongoose';\nimport Database from '../models/db';\n\n\nimport { ResponseHandler } from '../helpers/response_handler';\nimport { ErrorHandler } from '../helpers/error_handler';\nimport RedFlagModel from '../models/SOS.model.js';\nimport NotificationModel from '../models/Notification.model';\nimport AutoincrementId from '../helpers/autoincrement_mongo.js';\n// Database.establishConnection();\nconst MongooseDatabase = Database.getInstance() || new Database();\nexport class RedFlagService {\n  static createRedFlag(request, response) {\n    const { user_id, location, filename, address, status, media,email,phone_number,plate_number,username} = request.body;\n    // let id = Number(user_id) || Number(request.body.user_id);\n    console.log('you user id : ' + user_id);\n    let postData = request.body;\n    const NewRedflag = new RedFlagModel({ \n        id:  new AutoincrementId(RedFlagModel).counter(),\n        user_id, location, address, status, email,phone_number,plate_number,username,media: [filename] || 'cant find it'\n      });\n\n    NewRedflag.save()\n      .then(data => {\n        const redFlag = data;\n        return response.status(201).json({\n          status: 201,\n          data: [\n            {\n              id: redFlag.id,\n              message: 'Created sos record',\n            },\n          ],\n        });\n      })\n      .catch(err =>\n        response.status(400).json({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n  static allRedFlags(request, response) {\n    RedFlagModel.find()\n      .then(data => {\n        let redFlag = data;\n        if (redFlag.length === 0) {\n          redFlag = [\n            // {\n            //   id: 1,\n            //     user_id:5, \n            //     location:'89898888,09007667', \n            //     address:'lekki', \n            //     status:'unresolved'\n              \n            // },\n          ];\n\n          return response.status(200).json({\n            status: 200,\n            data: [\n              {\n                redFlag,\n                message: 'All redflags was retrieved successfully',\n              },\n            ],\n          });\n        }\n        return response.status(200).json({\n          status: 200,\n          data: [\n            {\n              redFlag,\n              message: 'All redflags was retrieved successfully',\n            },\n          ],\n        });\n      })\n      .catch(err =>\n        response.status(400).json({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n  static redFlagId(request, response) {\n    RedFlagModel.find({id: Number(request.params.id)})\n      .then(data => {\n        const redFlag = data;\n        if (redFlag.length <= 0) {\n          return response.status(404).json({\n            status: 404,\n            error: 'The id of the given red-flag was not found',\n          });\n        }\n        return response.status(200).json({\n          status: 200,\n          data: [\n            {\n              redFlag,\n              message: 'Get a specific red-flag was successful',\n            },\n          ],\n        });\n      })\n      .catch(err =>\n        response.status(400).json({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n  static deleteRedFlag(request, response) {\n    RedFlagModel.find({id: Number(request.params.id)})\n      .then(data => {\n        const redflags = data;\n\n        if ( redflags.length <= 0) {\n          console.log(\n            JSON.stringify({\n              status: 404,\n              error: 'The red-flag with the given id does not exists',\n            }),\n          );\n          return response.status(404).json({\n            status: 404,\n            error: 'The red-flag with the given id does not exists',\n          });\n        }\n        RedFlagModel.removeOne({id: Number(request.params.id)})\n          .then(data => {\n            const deletedRedFlag = data;\n            response.status(202).json({\n              status: 202,\n              data: [\n                {\n                  id: deletedRedFlag._id,\n                  message: 'red-flag record has been deleted',\n                },\n              ],\n            });\n          })\n          .catch(error =>\n            response.status(400).json({\n              status: 400,\n              error: ErrorHandler.errors().validationError,\n            }),\n          );\n      })\n      .catch(error =>\n        response.status(400).json({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n  static editRedFlag(request, response) {\n    RedFlagModel.find({id: Number(request.params.id)})\n      .then(redflagId => {\n        if (redflagId.length < 1) {\n          return response.status(404).json({\n            status: 404,\n            error: 'The location with the given red-flag id does not exists',\n          });\n        }\n        const { location } = request.body;\n        if ( Number(request.user.id) === Number(redflagId[0].user_id) )  {\n          RedFlagModel.updateOne({id: Number(request.params.id)}, {\n             \n                location: location\n             \n           }).then(data => {\n              const editRedFlags = data;\n              return response.status(200).json({\n                status: 200,\n                data: [\n                  {\n                    id: editRedFlags._id,\n                    editRedFlags,\n                    message: 'Updated red-flag record’s location',\n                  },\n                ],\n              });\n            })\n            .catch(error =>\n              response.status(400).json({\n                status: 400,\n                error: errors.validationError,\n              }),\n            );\n        } else {\n          return response.status(403).json({\n            status: 403,\n            error: 'You must signup or login to access this route',\n          });\n        }\n      })\n      .catch(error =>\n        response.status(400).json({\n          status: 400,\n          error:ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n  static editRedFlagComment(request, response) {\n    RedFlagModel.find({id: request.params.id})\n      .then(redflagId => {\n        if (redflagId.length <=0) {\n          return response.status(404).json({\n            status: 404,\n            error: 'The comment with the given red-flag id does not exists',\n          });\n        }\n        const { comment } = request.body;\n        if ( Number(request.user.id) === Number(redflagId[0].user_id) )  {\n          RedFlagModel.updateOne({id: Number(request.params.id)}, {\n            \n                comment: comment\n             \n           }).then(data => {\n              const editCommentRedFlag = data;\n              return response.status(200).json({\n                status: 200,\n                data: [\n                  {\n                    id: editCommentRedFlag._id,\n                    editCommentRedFlag,\n                    message: 'Updated red-flag record’s comment',\n                  },\n                ],\n              });\n            })\n            .catch(error =>\n              response.status(400).json({\n                status: 400,\n                error: ErrorHandler.errors().validationError,\n              }),\n            );\n        } else {\n          return response.status(401).json({\n            status: 401,\n            error: 'You must signup or login to access this route',\n          });\n        }\n      })\n      .catch(error =>\n        response.status(400).send({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n  static updateRedFlagStatus(request, response) {\n   RedFlagModel.find({id: Number(request.params.id)})\n  .then(redId => {\n        if (redId.length <= 0) {\n          return response.status(404).json({\n                      status: 404,\n                      error: 'The status with the given red-flag id does not exists',\n                    });\n        }\n         const { status } = request.body;\n     if ( Number(request.user.id) )  {\n\n\n            RedFlagModel.updateOne({id: Number(request.params.id) }, {\n                    \n                      status: status\n                  \n                }).then(data => {\n                  \n                const redflagStatus = data;\n                \n                return response.status(200).json({\n                  status: 200,\n                  data: [\n                    {\n                      id: redflagStatus._id,\n                      message: 'Updated red-flag record’s status',\n                    },\n                  ],\n                });\n              })\n              .catch(err =>\n                response.status(400).json({\n                  status: 400,\n                  error: ErrorHandler.errors().validationError,\n                }),\n              );\n\n    } else {\n          return response.status(401).json({\n            status: 401,\n            error: 'You must signup or login to access this route',\n          });\n        }\n      })\n      .catch(error =>\n        response.status(400).send({\n          status: 400,\n          error:ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n  static usersRedflags(request, response) {\n    // UserModel.find({user_id: request.params.id})\n    RedFlagModel.find({user_id: Number(request.params.id) })\n      .then(data => {\n        const redFlags = data;\n        if (redFlags.length === 0) {\n          return response.status(404).json({\n            status: 404,\n            error: 'User has no red-flag record',\n          });\n        }\n        console.log(redFlags)\n        return response.status(200).json({\n          status: 200,\n          data: [\n            {\n              redFlags,\n              type: 'Red-flag',\n              message: 'Successful',\n            },\n          ],\n        });\n      })\n      .catch(error =>\n        response.status(400).json({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n\n  static sendNotifications(request,response){\n\n    const { user_id, message, type, description } = request.body;\n    let id = Number(user_id) || Number(request.body.user_id);\n    console.log('you user id : ' + id);\n    let postData = request.body;\n    const NewNotification = new NotificationModel({ \n        id:  new AutoincrementId(NotificationModel).counter(),\n        user_id, message, type, description\n      });\n\n    NewNotification.save()\n      .then(data => {\n        const notification = data;\n        return response.status(201).json({\n          status: 201,\n          data: [\n            {\n              id: notification.id,\n              message: 'Created sos record',\n            },\n          ],\n        });\n      })\n      .catch(err =>\n        response.status(400).json({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n\n  }\n\n\n  static getNotifications(request,response){\n    NotificationModel.find({ user_id: Number(request.params.id) })\n    \n      .then(data => {\n        const notifications = data;\n        if (notifications.length === 0) {\n          return response.status(404).json({\n            status: 404,\n            error: 'User has no notifications record',\n          });\n        }\n        return response.status(200).json({\n          status: 200,\n          data: [\n            {\n              notifications,\n              type: 'notifications',\n              message: 'Successful',\n            },\n          ],\n        });\n      })\n      .catch(error =>\n        response.status(400).json({\n          status: 400,\n          error: ErrorHandler.errors().validationError,\n        }),\n      );\n  }\n\n}\n"],"file":"sos_service.js"}