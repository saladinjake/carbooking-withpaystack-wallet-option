{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/services/MailMan.js"],"names":["Q","require","nodemailer","emailTemplates","sendMailTransport","module","exports","_template","_transport","init","config","d","defer","emailTplsDir","err","template","reject","createTransport","service","auth","user","process","env","SENDGRID_USERNAME","pass","SENDGRID_PASSWORD","resolve","bind","promise","send","from","to","subject","text","html","params","sendMail","res","console","error","tplName","locals","self","then"],"mappings":"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","sourcesContent":["var Q = require('q');\nvar nodemailer = require('nodemailer');\nvar emailTemplates = require('email-templates');\nvar sendMailTransport = require('nodemailer-smtp-transport');\n/****************************************************************/\n/******* @author saladin jake (Victor juwa) ********************************/\n/******* @desc Express js || ****************/\nmodule.exports = {\n  _template: null,\n  _transport: null,\n\n  init: function(config) {\n    var d = Q.defer();\n\n    emailTemplates(\n      config.emailTplsDir,\n      function(err, template) {\n        if (err) {\n          return d.reject(err);\n        }\n\n        this._template = template;\n        this._transport = nodemailer.createTransport({\n          service: 'Sendgrid',\n          auth: { user: process.env.SENDGRID_USERNAME, pass: process.env.SENDGRID_PASSWORD },\n        });\n        return d.resolve();\n      }.bind(this),\n    );\n\n    return d.promise;\n  },\n\n  send: function(from, to, subject, text, html) {\n    var d = Q.defer();\n    var params = {\n      from: from,\n      to: to,\n      subject: subject,\n      text: text,\n    };\n\n    if (html) {\n      params.html = html;\n    }\n\n    this._transport.sendMail(params, function(err, res) {\n      if (err) {\n        console.error(err);\n        return d.reject(err);\n      } else {\n        return d.resolve(res);\n      }\n    });\n\n    return d.promise;\n  },\n\n  sendMail: function(from, to, subject, tplName, locals) {\n    var d = Q.defer();\n    var self = this;\n    this.init({ emailTplsDir: 'email-templates' }).then(\n      function() {\n        this._template(tplName, locals, function(err, html, text) {\n          if (err) {\n            console.error(err);\n            return d.reject(err);\n          }\n\n          self.send(from, to, subject, text, html).then(function(res) {\n            return d.resolve(res);\n          });\n        });\n      }.bind(this),\n    );\n\n    return d.promise;\n  },\n};\n"],"file":"MailMan.js"}