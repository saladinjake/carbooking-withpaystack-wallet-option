{"version":3,"sources":["../../../../server/dynamic_server/mongo_api/controllers/customer.controller.js"],"names":["httpStatus","require","omit","Customer","errorHandler","handler","exports","load","req","res","next","id","get","customer","locals","json","transform","loggedIn","create","body","save","savedCustomer","status","CREATED","checkDuplicateEmail","replace","newCustomer","ommitRole","role","newCustomerObject","toObject","update","override","upsert","findById","_id","updatedCustomer","Object","assign","then","e","list","query","customers","transformedCustomers","map","remove","NO_CONTENT","end"],"mappings":"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","sourcesContent":["const httpStatus = require('http-status');\nconst { omit } = require('lodash');\nconst Customer = require('../models/customer.model');\nconst { handler: errorHandler } = require('../middlewares/error');\n\n/**\n * Load customer and append to req.\n * @public\n */\nexports.load = async (req, res, next, id) => {\n  try {\n    const customer = await Customer.get(id);\n    req.locals = { customer };\n    return next();\n  } catch (error) {\n    return errorHandler(error, req, res);\n  }\n};\n\n/**\n * Get customer\n * @public\n */\nexports.get = (req, res) => res.json(req.locals.customer.transform());\n\n/**\n * Get logged in customer info\n * @public\n */\nexports.loggedIn = (req, res) => res.json(req.customer.transform());\n\n/**\n * Create new customer\n * @public\n */\nexports.create = async (req, res, next) => {\n  try {\n    const customer = new Customer(req.body);\n    const savedCustomer = await customer.save();\n    res.status(httpStatus.CREATED);\n    res.json(savedCustomer.transform());\n  } catch (error) {\n    next(Customer.checkDuplicateEmail(error));\n  }\n};\n\n/**\n * Replace existing customer\n * @public\n */\nexports.replace = async (req, res, next) => {\n  try {\n    const { customer } = req.locals;\n    const newCustomer = new Customer(req.body);\n    const ommitRole = customer.role !== 'admin' ? 'role' : '';\n    const newCustomerObject = omit(newCustomer.toObject(), '_id', ommitRole);\n\n    await customer.update(newCustomerObject, { override: true, upsert: true });\n    const savedCustomer = await Customer.findById(customer._id);\n\n    res.json(savedCustomer.transform());\n  } catch (error) {\n    next(Customer.checkDuplicateEmail(error));\n  }\n};\n\n/**\n * Update existing customer\n * @public\n */\nexports.update = (req, res, next) => {\n  const ommitRole = req.locals.customer.role !== 'admin' ? 'role' : '';\n  const updatedCustomer = omit(req.body, ommitRole);\n  const customer = Object.assign(req.locals.customer, updatedCustomer);\n\n  customer.save()\n    .then(savedCustomer => res.json(savedCustomer.transform()))\n    .catch(e => next(Customer.checkDuplicateEmail(e)));\n};\n\n/**\n * Get customer list\n * @public\n */\nexports.list = async (req, res, next) => {\n  try {\n    const customers = await Customer.list(req.query);\n    const transformedCustomers = customers.map(customer => customer.transform());\n    res.json(transformedCustomers);\n  } catch (error) {\n    next(error);\n  }\n};\n\n/**\n * Delete customer\n * @public\n */\nexports.remove = (req, res, next) => {\n  const { customer } = req.locals;\n\n  customer.remove()\n    .then(() => res.status(httpStatus.NO_CONTENT).end())\n    .catch(e => next(e));\n};\n"],"file":"customer.controller.js"}