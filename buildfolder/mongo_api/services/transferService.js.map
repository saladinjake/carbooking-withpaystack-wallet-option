{"version":3,"sources":["../../../server/mongo_api/services/transferService.js"],"names":["uuidv4","require","crypto","moment","GatewayTransaction","APIError","httpStatus","Customer","Transaction","exports","transfer","accountNumber","amount","destinationAccountNumber","reference","transaction","operation","save","savedTransaction","findOne","savedCustomer","transactionBeneficiary","savedTransactionBeneficiary","response","transform","customer","transformBalance"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,MAAM,2BAAGC,OAAO,CAAC,SAAD,CAAV,CAAZ;AACA,IAAMC,MAAM,2BAAGD,OAAO,CAAC,QAAD,CAAV,CAAZ;AACA,IAAME,MAAM,2BAAGF,OAAO,CAAC,iBAAD,CAAV,CAAZ;AACA,IAAMG,kBAAkB,2BAAGH,OAAO,CAAC,oCAAD,CAAV,CAAxB;AACA,IAAMI,QAAQ,2BAAGJ,OAAO,CAAC,mBAAD,CAAV,CAAd;AACA,IAAMK,UAAU,2BAAGL,OAAO,CAAC,aAAD,CAAV,CAAhB;AACA,IAAMM,QAAQ,2BAAGN,OAAO,CAAC,sBAAD,CAAV,CAAd;AACA,IAAMO,WAAW,2BAAGP,OAAO,CAAC,6BAAD,CAAV,CAAjB;AACA;;AACA;;AACA;;;;AACAQ,OAAO,CAACC,QAAR;AAAA,2FAAmB,iBAAOC,aAAP,EAAsBC,MAAtB,EAA8BC,wBAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACXC,YAAAA,SADW,2BACCd,MAAM,EADP;AAGXe,YAAAA,WAHW,4BAGG,IAAIP,WAAJ,EAHH;AAAA;AAIjBO,YAAAA,WAAW,CAACH,MAAZ,GAAqB,CAACA,MAAtB;AAJiB;AAKjBG,YAAAA,WAAW,CAACC,SAAZ,GAAwB,UAAxB;AALiB;AAMjBD,YAAAA,WAAW,CAACJ,aAAZ,GAA4BA,aAA5B;AANiB;AAOjBI,YAAAA,WAAW,CAACF,wBAAZ,GAAuCA,wBAAvC;AAPiB;AAQjBE,YAAAA,WAAW,CAACD,SAAZ,GAAwB,yBAAyBD,wBAAjD;AARiB;AAAA;AAAA,mBAScE,WAAW,CAACE,IAAZ,EATd;;AAAA;AASXC,YAAAA,gBATW;AAAA;AAAA;AAAA,mBAUWX,QAAQ,CAACY,OAAT,CAAiB;AAAER,cAAAA,aAAa,EAAEA;AAAjB,aAAjB,CAVX;;AAAA;AAUXS,YAAAA,aAVW;AAYXC,YAAAA,sBAZW,4BAYc,IAAIb,WAAJ,EAZd;AAAA;AAajBa,YAAAA,sBAAsB,CAACT,MAAvB,GAAgCA,MAAhC;AAbiB;AAcjBS,YAAAA,sBAAsB,CAACL,SAAvB,GAAmC,UAAnC;AAdiB;AAejBK,YAAAA,sBAAsB,CAACV,aAAvB,GAAuCE,wBAAvC;AAfiB;AAgBjBQ,YAAAA,sBAAsB,CAACP,SAAvB,GAAmC,2BAA2BH,aAA9D;AAhBiB;AAAA;AAAA,mBAiByBU,sBAAsB,CAACJ,IAAvB,EAjBzB;;AAAA;AAiBXK,YAAAA,2BAjBW;AAmBXC,YAAAA,QAnBW,4BAmBA;AACfR,cAAAA,WAAW,EAAEA,WAAW,CAACS,SAAZ,EADE;AAEfC,cAAAA,QAAQ,EAAEL,aAAa,CAACM,gBAAd;AAFK,aAnBA;AAAA;AAAA,6CAwBVH,QAxBU;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAnB;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const uuidv4 = require('uuid/v4');\nconst crypto = require('crypto');\nconst moment = require('moment-timezone');\nconst GatewayTransaction = require('../models/gatewayTransaction.model');\nconst APIError = require('../utils/APIError');\nconst httpStatus = require('http-status');\nconst Customer = require('../models/User.model');\nconst Transaction = require('../models/transaction.model');\n/****************************************************************/\n/******* @author saladin jake (Victor juwa) ********************************/\n/******* @desc Express js || ****************/\nexports.transfer = async (accountNumber, amount, destinationAccountNumber) => {\n  const reference = uuidv4();\n\n  const transaction = new Transaction();\n  transaction.amount = -amount;\n  transaction.operation = 'transfer';\n  transaction.accountNumber = accountNumber;\n  transaction.destinationAccountNumber = destinationAccountNumber;\n  transaction.reference = 'transfer_to_account:' + destinationAccountNumber;\n  const savedTransaction = await transaction.save();\n  const savedCustomer = await Customer.findOne({ accountNumber: accountNumber });\n\n  const transactionBeneficiary = new Transaction();\n  transactionBeneficiary.amount = amount;\n  transactionBeneficiary.operation = 'transfer';\n  transactionBeneficiary.accountNumber = destinationAccountNumber;\n  transactionBeneficiary.reference = 'transfer_from_account:' + accountNumber;\n  const savedTransactionBeneficiary = await transactionBeneficiary.save();\n\n  const response = {\n    transaction: transaction.transform(),\n    customer: savedCustomer.transformBalance(),\n  };\n\n  return response;\n};\n"],"file":"transferService.js"}